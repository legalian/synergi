
{% extends "template.html"%}
{% set active_page = "projectlist" %}
{% block body %}
<style>
	.project {
		background: #EEE;
		margin-top: 40px;
		margin-left: 20%;
		margin-right:20%;
		border-radius: 8px;
	}
	.project ul{

	}
	.project ul li{
		display: inline-block;
		padding: 10px;
		/*border-color: red;border-style: solid;border-width: 2px;*/

	}
	.edit{
		float:right;
	}
	.edit a{
		font-size: 1.5em;
		box-shadow: none !important;
		transition: none;
		text-decoration: none;
		color: inherit;
		line-height: 1.8em;

	}
	.name {
		font-size: 2em;
	}

	.expander{
		float:left;
	}
	.dropdown {
	  position: relative;
	  display: inline-block;
	}

	.dropdown-content {
	  display: none;
	  position: absolute;
	  background-color: #f9f9f9;
	  min-width: 160px;
	  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
	  padding: 12px 16px;
	  z-index: 1;
	}

	.border {
		border-width: 2px;
		border-style: solid;
		border-color: red;
	}

	.flex-v {
		display: flex;
		flex-direction: column;
	}
	.flex-h {
		display: flex;
		flex-direction: row;
	}
	.content-left {
		width:50%;
	}
	.content-right {
		width:50%;
	}
</style>



<!-- <div class="wrap-collabsible">
  <input id="collapsible" class="toggle" type="checkbox">
  <label for="collapsible" class="lbl-toggle">More Info</label>
  <div class="collapsible-content">
    <div class="content-inner">
      <p>
        QUnit is by calling one of the object that are embedded in JavaScript, and faster JavaScript program could also used with
        its elegant, well documented, and functional programming using JS, HTML pages Modernizr is a popular browsers without
        plug-ins. Test-Driven Development.
      </p>
    </div>
  </div>
</div> -->


<div class="hover_bkgr_fricc">
    <span class="helper"></span>
    <div class = "popup_html_fricc">
        <div class="popupCloseButton">X</div>
        <form action = "/projects" method = "POST">
        	<h2>Import Project</h2>
			<input type="hidden" name="owner" data-bind="value:owner">
			Name of Project: <input class="input_" type="text" name="name"><br>
				Description: <input class="input_" type="text" name="description"><br>
				<span class="custom-dropdown">
				Repo: <select name="repo" data-bind="options: repochoices(),value:activerepo"></select>
			</span>
			<span class="custom-dropdown">
				Branch: <select name="branch" data-bind="options: branches()"></select>
				</span>
				<input id="" class="btn" type="submit" value="Import Project">
			</form>
    </div>
</div>


<div id="extra" class="container" data-bind="foreach:results">
	<div class = "project wrap-collabsible">
		<input data-bind="attr:{id:$index()}" class="toggle" type="checkbox">
		<label data-bind="attr:{for:$index()},text:name" class="lbl-toggle">[Name]</label>
		<div class="collapsible-content">
			<ul>
				<li class = "name" data-bind="text:name">Name</li>
				<li class="edit"><a data-bind="attr:{href:'/editor?projectId='+id}">Edit</a></li>
				<li class="delete edit"><a data-bind = "click: deleteObject">Delete</a></li>
			</ul>
			<ul class ="flex-h content-inner">
				<div class = "flex-v content-left border">
					<div class = "flex-h">
						<div>Repository:&nbsp; </div>
						<div class="value" data-bind="text:repo">[repo]</div>
					</div>
					<div class = "flex-h">
						<div>Branch:&nbsp; </div>
						<div class="value" data-bind="text:branch">[branch]</div>
					</div>
				</div>
				<div class = "flex-v content-right border">
					<li class = ""><div>Description:  </div></li>
					<li class = ""><div data-bind="text:description"></div></li>
				</div>				
			</ul>
		</div>	
	</div>
</div>


<script>

var justice = new AppViewModel();
function deleteObject(dat) {
		console.log("trying to delete")
		console.log(".")
		console.log(".")
		console.log(".")
		console.log(".")
		$.ajax("/deleteObject", {
					type: "POST",
					data: ko.toJSON({
						projectid:dat.id
					}),
					contentType: "application/json",
					success: function(data){
						console.log("Deleted")
						justice.results.remove(dat);
					}
				});
	}

function AppViewModel() {
	var self =	this;
	self.repos    = ko.observableArray([]);
	self.activerepo = ko.observable(null);
	self.repochoices = ko.computed(function(){
		return self.repos().map(function(item){return item.name})
	})
	self.branches = ko.computed(function(){
		var ind = self.repochoices().indexOf(self.activerepo())
		if (ind == -1) {return []}
		return self.repos()[ind].branches
	})
	self.owner = ko.computed(function(){
		var ind = self.repochoices().indexOf(self.activerepo())
		if (ind == -1) {return null}
		return self.repos()[ind].owner
	});


	self.results  = ko.observableArray([]);
	

	
	$.ajax("/repos", {
		type: "GET",
		success: function(data){
			self.results(data['res']);
			self.repos(data['openrepos'])
		}
	});



}



ko.applyBindings(justice);

</script>


{% endblock %}